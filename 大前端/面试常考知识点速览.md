---
title: "é¢è¯•å¿…åˆ·"
author: "å‡¢å‡¢"
date: "2019-09-02"
permalink: "interview"
sidebar: "auto"
single: true
---

## æ™®é€šå‡½æ•°å’Œç®­å¤´å‡½æ•°çš„ this

```js
function fn() {
  console.log(this); // 1. {a:100}
  var arr = [1, 2, 3];

  (function() {
    console.log(this); // 2. window
  })();

  // æ™®é€šjs
  arr.map(function(item) {
    console.log(this); // 3. winodw
    return item + 1;
  });

  // ç®­å¤´å‡½æ•°
  let brr = arr.map(item => {
    console.log("es6", this); // 4. {a:100}
    return item + 1;
  });
}
fn.call({ a: 100 });
```

1. es5 æ™®é€šå‡½æ•°
   - å‡½æ•°è¢«ç›´æ¥è°ƒç”¨ï¼Œä¸Šä¸‹æ–‡ä¸€å®šæ˜¯ window
   - å‡½æ•°ä½œä¸ºå¯¹è±¡çš„å±æ€§è¢«è°ƒç”¨ï¼Œä¾‹å¦‚ Obj.foo()ï¼›ä¸Šä¸‹æ–‡å°±æ˜¯å¯¹è±¡æœ¬èº«
   - é€šè¿‡ new è°ƒç”¨ï¼Œthis ç»‘å®šåœ¨è¿”å›çš„å®ä¾‹ä¸Š
2. ç®­å¤´å‡½æ•°
   - ç®­å¤´å‡½æ•°æœ¬èº«æ²¡æœ‰ thisï¼Œå®ƒä¼šé¡ºç€ä½œç”¨åŸŸå‘ä¸Šå¯»æ‰¾ï¼Œç›´åˆ° global/windowã€‚

```js
function run() {
  const inner = () => {
    return () => {
      console.log(this.a);
    };
  };

  inner()();
}

run.bind({ a: 1 })(); // Output: 1
```

3. bind ç»‘å®šä¸Šä¸‹æ–‡è¿”å›æ–°çš„å‡½æ•°
   - å°±æ˜¯ç¬¬ä¸€ä¸ª bind çš„ä¸Šä¸‹æ–‡ï¼Œè€Œä¸” bind å¯¹ç®­å¤´å‡½æ•°æ— æ•ˆã€‚

```js
function run() {
  console.log(this.a);
}

run.bind({ a: 1 })(); // Output: 1

// å¤šæ¬¡bindï¼Œä¸Šä¸‹æ–‡ç”±ç¬¬ä¸€ä¸ªbindçš„ä¸Šä¸‹æ–‡å†³å®š
run.bind({ a: 2 }).bind({ a: 1 })(); // output: 2
```

### ä¼˜å…ˆçº§

`new > bind > å¯¹è±¡è°ƒç”¨ > ç›´æ¥è°ƒç”¨`

## åŸå§‹æ•°æ®ç±»å‹å’Œåˆ¤æ–­æ–¹æ³•

> é¢˜ç›®ï¼šJS ä¸­çš„åŸå§‹æ•°æ®ç±»å‹ï¼Ÿ

ECMAScript ä¸­å®šä¹‰äº† 7 ä¸­æ•°æ®ç±»å‹ï¼š

- Boolean
- String
- Number
- Null
- Undefined
- Symbol _(es6 æ–°å¢)_
- BigInt å¤§äº 2^53 æ­£æ•´æ•° _(es6 æ–°å¢ï¼ŒV8 å¼•æ“ v6.7 é»˜è®¤å¯ç”¨å¯¹ BigInt çš„æ”¯æŒã€‚)_

**åŸå§‹ç±»å‹ä¸åŒ…å« Object/Function**

> é¢˜ç›®ï¼š å¸¸ç”¨çš„åˆ¤æ–­æ–¹æ³•ï¼Ÿ

åœ¨è¿›è¡Œåˆ¤æ–­çš„æ—¶å€™æœ‰ typeofã€instanceofã€‚å¯¹äºæ•°ç»„çš„åˆ¤æ–­æœ‰ Array.isArray();

- typeof:

  - typeof åŸºæœ¬éƒ½å¯ä»¥æ­£ç¡®åˆ¤æ–­æ•°æ®ç±»å‹
  - typeof null å’Œ typeof [1,2,3] å‡è¿”å› 'object'
  - ES6 æ–°å¢ï¼š typeof Symbol() è¿”å› 'symbol'

- instanceof:
  - ä¸“é—¨ç”¨äºå®ä¾‹å’Œæ„é€ å‡½æ•°å¯¹åº”

```js
function Obj(value) {
  this.value = value;
}

let obj = new Obj("test");
console.log(obj instanceof Obj); // Output: true
```

- åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„ï¼š [1,2,3] instanceof Array
- Array.isArray(): ES6 æ–°å¢ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ 'Array' Array.isArray({}) è¿”å› false;

## åŸå§‹ç±»å‹è½¬æ¢

å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œæ•°å­¦è¿ç®—æ“ä½œçš„æ—¶å€™ï¼Œä¼šæ¶‰åŠåˆ° å¯¹è±¡ => åŸºæœ¬æ•°æ®ç±»å‹çš„è½¬åŒ–é—®é¢˜ã€‚

å½“ä¸€ä¸ªå¯¹è±¡æ‰§è¡ŒåŠ æ³•æ“ä½œçš„æ—¶å€™ï¼Œå¦‚æœå®ƒæ˜¯åŸå§‹ç±»å‹ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦è½¬æ¢ã€‚å¦åˆ™ï¼Œå°†éµå¾ªä»¥ä¸‹è§„åˆ™ï¼›

1. è°ƒç”¨å®ä¾‹çš„ valueOf()æ–¹æ³•ï¼Œå¦‚æœæœ‰è¿”å›åŸå§‹ç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆå°±åœæ­¢ä¸‹é¢çš„è¿‡ç¨‹ï¼›å¦åˆ™ç»§ç»­
2. è°ƒç”¨å®ä¾‹çš„ toString()æ–¹æ³•ï¼Œå¦‚æœæœ‰è¿”å›çš„æ˜¯åŸºç¡€ç±»å‹ï¼Œåœæ­¢ä¸‹é¢çš„è¿‡ç¨‹ï¼›å¦åˆ™ç»§ç»­
3. éƒ½æ²¡æœ‰è¿”å›åŸå§‹ç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™

```js
let a = {
  toString() {
    return "a"; // è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²
  }
};

let b = {
  valueOf() {
    return 100; // è¿”å›æ•°å€¼å‹
  },
  toString() {
    return "b";
  }
};

let c = Object.create(null); //  åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡

console.log(a + "123"); // output: a123
console.log(b + 1); // output: 101
console.log(c + "123"); // æŠ¥é”™
```

é™¤äº† valueOf å’Œ toStringï¼Œes6 è¿˜æä¾›äº† Symbol.toPrimitive ä¾›å¯¹è±¡å‘åŸå§‹ç±»å‹è½¬åŒ–ï¼Œå¹¶ä¸”å®ƒçš„ä¼˜å…ˆçº§æœ€é«˜ï¼

```js
let b = {
  valueOf() {
    return 100;
  },
  toString() {
    return "b";
  },
  [Symbol.toPrimitive]() {
    return "æœ€é«˜ä¼˜å…ˆçº§";
  }
};
console.log(b + 123); // 'æœ€é«˜ä¼˜å…ˆçº§123'
```

å…³äº instanceof åˆ¤æ–­æ˜¯å¦ä¸ºæŸä¸ªå¯¹è±¡çš„å®ä¾‹ï¼Œes6 ä¹Ÿæä¾›äº† Symbol.hasIntance æ¥å£ã€‚

```js
class Even {
    static [Symbol.hasInstance](num){
        return Number(num) % 2 === 0;
    }
}

cost Odd = {
    [Symbol.hasInstance](num){
        return Number(num) % 2 !== 0;
    }
};

console.log(1 instanceof Even); // output: false
console.log(1 instanceof Odd); // output: true
```

## æ·±æ‹·è´å’Œæµ…æ‹·è´

> é¢˜ç›®ï¼šå®ç°å¯¹è±¡çš„æ·±æ‹·è´ã€‚

åœ¨ JS ä¸­ï¼Œå‡½æ•°å’Œå¯¹è±¡éƒ½æ˜¯æµ…æ‹·è´ ï¼ˆåœ°å€å¼•ç”¨ï¼‰ï¼›å…¶ä»–çš„åŸå§‹æ•°æ®ç±»å‹éƒ½æ˜¯æ·±æ‹·è´ï¼ˆå€¼å¼•ç”¨ï¼‰ã€‚es6 çš„ Object.assign() å’Œ `...` è§£æ„è¿ç®—ç¬¦éƒ½æ˜¯æµ…æ‹·è´ã€‚å®ç°æ·±æ‹·è´è¿˜éœ€è‡ªå·±é€ è½®å­æˆ–è€…å¼•å…¥ç¬¬ä¸‰æ–¹åº“(lodash) cloneDeep(src);

```js
/**
 * æ•°ç»„çš„æ·±æ‹·è´å‡½æ•°
 * @param {Array} src
 * @param {Array} target
 */

function cloneArr(src, target) {
  for (let item of src) {
    if (Array.isArray(item)) {
      target.push(cloneArr(item, []));
    } else if (typeof item === "object") {
      target.push(deepClone(item, {}));
    } else {
      target.push(item);
    }
  }
  return target;
}

/**
 * å¯¹è±¡çš„æ·±æ‹·è´å®ç°
 * @param {Object} src
 * @param {Object} target
 * @return {Object}
 */

function deepClone(src, target) {
  const keys = Reflect.ownkeys(src);
  let value = null;

  for (let key of keys) {
    value = src[key];

    if (Array.isArray(value)) {
      target[key] = cloneArr(value, []);
    } else if (typeof value === "object") {
      // å¦‚æœæ˜¯å¯¹è±¡è€Œä¸”ä¸æ˜¯æ•°ç»„, é‚£ä¹ˆé€’å½’è°ƒç”¨æ·±æ‹·è´
      target[key] = deepClone(value, {});
    } else {
      target[key] = value;
    }
  }
  return target;
}
```

### å…¶ä»–æ·±æ‹·è´æ–¹æ³•

- ç¬¬ä¸‰åº“ extend()/cloneDeep(src)
- JSON.parse(JSON.stringify(src)): å¦‚æœå±æ€§å€¼æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–è€…ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œå°†æ— æ³•æ­£ç¡®æ‹·è´ã€‚
- HTML5 çš„ messageChannel

```js
<script>
  function deepClone(obj) {
    return new Promise(resolve => {
      const { port1, port2 } = new MessageChannel();
      port2.onmessage = ev => resolve(ev.data);
      port1.postMessage(obj);
    });
  }

  const obj = {
    a: 1,
    b: {
      c: [1, 2],
      d: "() => {}"
    }
  };

  deepClone(obj).then(obj2 => {
    obj2.b.c[0] = 100;
    console.log(obj.b.c); // output: [1, 2]
    console.log(obj2.b.c); // output: [100, 2]
  });
</script>
```

## JS äº‹ä»¶æµ

äº‹ä»¶æµåˆ†ä¸ºå†’æ³¡å’Œæ•è·ï¼Œé¡ºåºæ˜¯å…ˆæ•è·å†å†’æ³¡ã€‚

```js
<div id="app" style="width: 100vw; background: red;">
  <span id="btn">ç‚¹æˆ‘</span>
</div>
<script>
  // äº‹ä»¶æ•è·ï¼šå…ˆè¾“å‡º "å¤–å±‚clickäº‹ä»¶è§¦å‘"; å†è¾“å‡º "å†…å±‚clickäº‹ä»¶è§¦å‘"
  var useCapture = true;
  var btn = document.getElementById("btn");
  btn.addEventListener(
    "click",
    function() {
      console.log("å†…å±‚clickäº‹ä»¶è§¦å‘");
    },
    useCapture
  );

  var app = document.getElementById("app");
  app.onclick = function() {
    console.log("å¤–å±‚clickäº‹ä»¶è§¦å‘");
  };
</script>
```

### DOM çº§ å’Œ DOM2 çº§

DOM2 çº§ï¼šå‰é¢è¯´çš„ addEventListenerï¼Œå®ƒå®šä¹‰äº† DOM äº‹ä»¶æµï¼Œæ•è· + å†’æ³¡ã€‚

DOM0 çº§:

- ç›´æ¥åœ¨ html æ ‡ç­¾å†…ç»‘å®š on äº‹ä»¶
- åœ¨ JS ä¸­ç»‘å®š on ç³»åˆ—äº‹ä»¶

DON2 ä¼˜ç‚¹ï¼š

- å¯ä»¥ç»‘å®šå’Œå¸è½½äº‹ä»¶
- æ”¯æŒäº‹ä»¶æµ
- å†’æ³¡ + æ•è·
- åŒä¸€ç±»äº‹ä»¶å¯ä»¥ç»‘å®šå¤šä¸ªå‡½æ•°

## å¸¸è§çš„é«˜é˜¶å‡½æ•°

```js
// map: ç”Ÿæˆä¸€ä¸ªæ–°æ•°ç»„ï¼Œéå†åŸæ•°ç»„ï¼Œ
// å°†æ¯ä¸ªå…ƒç´ æ‹¿å‡ºæ¥åšä¸€äº›å˜æ¢ç„¶åæ”¾å…¥åˆ°æ–°çš„æ•°ç»„ä¸­
let newArr = [1, 2, 3].map(item => item * 2);
console.log(`New array is ${newArr}`);

// filter: æ•°ç»„è¿‡æ»¤, æ ¹æ®è¿”å›çš„boolean
// å†³å®šæ˜¯å¦æ·»åŠ åˆ°æ•°ç»„ä¸­
let newArr2 = [1, 2, 4, 6].filter(item => item !== 6);
console.log(`New array2 is ${newArr2}`);

// reduce: ç»“æœæ±‡æ€»ä¸ºå•ä¸ªè¿”å›å€¼
// acc: ç´¯è®¡å€¼; current: å½“å‰item
let arr = [1, 2, 3];
const sum = arr.reduce((acc, current) => acc + current);
const sum2 = arr.reduce((acc, current) => acc + current, 100);
console.log(sum); // 6
console.log(sum2); // 106
```

## ES5 ç»§æ‰¿

### æ–¹æ³•ä¸€ï¼š ç»‘å®šæ„é€ å‡½æ•°

```js
function Animal() {
  this.species = "åŠ¨ç‰©";
}

function Cat() {
  // æ‰§è¡Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œä¸Šä¸‹æ–‡ä¸ºå®ä¾‹å¯¹è±¡
  Animal.apply(this, arguments);
}

/**
 * æµ‹è¯•ä»£ç 
 */
var cat = new Cat();
console.log(cat.species); // output: åŠ¨ç‰©
```

### æ–¹æ³•äºŒï¼š åŸå‹é“¾ç»§æ‰¿

```js
function Animal(species) {
  this.sepcies = species;
}

Animal.prototype.func = function() {
  console.log("Animal");
};

function Cat() {}

/**
 * funcæ–¹æ³•æ˜¯æ— æ•ˆçš„, å› ä¸ºåé¢åŸå‹é“¾è¢«é‡æ–°æŒ‡å‘äº†Animalå®ä¾‹
 */
Cat.prototype.func = function() {
  console.log("Cat");
};

Cat.prototype = new Animal(); // è¦†ç›–äº†ä¸Šé¢æ–¹æ³•å®šä¹‰
Cat.prototype.constructor = Cat; // ä¿®å¤: å°†Cat.prototype.constructoré‡æ–°æŒ‡å‘æœ¬èº«

/**
 * æµ‹è¯•ä»£ç 
 */
var cat = new Cat();
cat.func(); // output: Animal
console.log(cat.species); // undefined
```

### æ–¹æ³•ä¸‰ï¼š ç»„åˆç»§æ‰¿

```js
function Animal(species) {
  this.species = species;
}

Animal.prototype.func = function() {
  console.log("Animal");
};

function Cat() {
  Animal.apply(this, arguments); // æ„é€ å‡½æ•°ç»§æ‰¿çˆ¶ç±»çš„å±æ€§
}

Cat.prototype = new Animal(); // Animal è¢«è°ƒç”¨äº†2æ¬¡
Cat.prototype.constructor = Cat;

/**
 * æµ‹è¯•ä»£ç 
 */
var cat = new Cat("cat");
cat.func(); // output: Animal
console.log(cat.species); // output: cat
```

### æ–¹æ³•å››ï¼š å¯„ç”Ÿç»„åˆç»§æ‰¿

```js
/**
 * å¯„ç”Ÿç»„åˆç»§æ‰¿çš„æ ¸å¿ƒä»£ç 
 * @param {Function} sub å­ç±»
 * @param {Function} parent çˆ¶ç±»
 */

function inheritPrototype(sub, parent) {
  // æ‹¿åˆ°çˆ¶ç±»çš„åŸå‹
  var prototype = Object.create(parent.prototype);
  // æ”¹å˜constructoræŒ‡å‘
  prototype.constructor = sub;
  // çˆ¶ç±»åŸå‹èµ‹ç»™å­ç±»
  sub.prototype = prototype;
}

function Animal(species) {
  this.species = species;
}
Animal.prototype.func = function() {
  console.log("Animal");
};

function Cat() {
  Animal.apply(this, arguments); // åªè°ƒç”¨äº†1æ¬¡æ„é€ å‡½æ•°
}

inheritPrototype(Cat, Animal);
// inheritPrototypeç›´æ¥ç»§æ‰¿çš„æ˜¯çˆ¶ç±»çš„åŸå‹ï¼Œè€Œä¸æ˜¯æ•´ä¸ªçˆ¶ç±»çš„å®ä¾‹

/**
 * æµ‹è¯•ä»£ç 
 */

var cat = new Cat("cat");
cat.func(); // output: Animal
console.log(cat.species); // output: cat
```

## åŸå‹å’ŒåŸå‹é“¾

- æ‰€æœ‰å¼•ç”¨ç±»å‹(æ•°ç»„ã€å¯¹è±¡ã€å‡½æ•°)ï¼Œéƒ½æœ‰ä¸€ä¸ª**proto**å±æ€§
- æ‰€æœ‰çš„å‡½æ•°éƒ½æœ‰ä¸€ä¸ª prototype å±æ€§ï¼Œå±æ€§å€¼æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡
- æ‰€æœ‰å¼•ç”¨ç±»å‹ï¼Œ**proto** å±æ€§å€¼éƒ½æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„ prototype å±æ€§å€¼

**ES6 ç®­å¤´å‡½æ•°æ²¡æœ‰ prtotype å±æ€§ï¼Œä½†æ˜¯æœ‰ **proto** å±æ€§**

```js
const obj = {};
// å¼•ç”¨ç±»å‹çš„ __proto__ å±æ€§å€¼æŒ‡å‘å®ƒçš„æ„é€ å‡½æ•°çš„ prototype å±æ€§å€¼
console.log(obj.__proto__ === Object.prototype); // output: true
```

### åŸå‹

> é¢˜ç›®ï¼š å¦‚ä½•ç†è§£ JS ä¸­çš„åŸå‹ï¼Ÿ

```js
// æ„é€ å‡½æ•°
function Foo(name, age) {
  this.name = name;
}
Foo.prototype.alertName = function() {
  alert(this.name);
};
// åˆ›å»ºç¤ºä¾‹
var f = new Foo("zhangsan");
f.printName = function() {
  console.log(this.name);
};
// æµ‹è¯•
f.printName();
f.alertName();
```

å½“è¯•å›¾å¾—åˆ°ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§æ—¶ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡æœ¬èº«æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå°±ä¼šå»å®ƒçš„**proto** ï¼ˆåŸå‹ï¼‰ä¸­å¯»æ‰¾ã€‚

### åŸå‹é“¾

> é¢˜ç›®: å¦‚ä½•è§£é‡Š JS ä¸­çš„åŸå‹é“¾ï¼Ÿ

å¯¹è±¡çš„å±æ€§æŸ¥æ‰¾ä¼šå¯»æ‰¾åŸå‹é“¾ä¸€å±‚å±‚å‘ä¸Šæ‰¾ï¼ŒåŸå‹é“¾çš„å°¾ç«¯æ˜¯ Oject.prototypeã€‚è¿™æ˜¯ä¸€ä¸ªæ·±åº¦éå†çš„è¿‡ç¨‹ï¼Œå¯»æ‰¾çš„ä¾æ®å°±æ˜¯ä¸€ä¸ªé“¾å¼ç»“æ„ï¼Œæ‰€ä»¥å«åšåŸå‹é“¾ã€‚

## ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾

> é¢˜ç›®ï¼š å¦‚ä½•ç†è§£ JS çš„ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾

1. ä½œç”¨åŸŸ

ES5 æœ‰ å…¨å±€ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸï¼ŒES6 å¼•å…¥äº†å—ä½œç”¨åŸŸï¼Œä½œç”¨åŸŸå¯ä»¥é˜²æ­¢å˜é‡æ±¡æŸ“ã€‚

2. ä½œç”¨åŸŸé“¾

å½“å‰ä½œç”¨åŸŸä¸­æ²¡æœ‰æŸ¥è¯¢åˆ°å˜é‡ï¼Œåˆ™ä¼šå‘ä¸ŠæŸ¥æ‰¾ï¼Œä¸€ç›´åˆ°é¡¶å±‚çš„å…¨å±€ä½œç”¨åŸŸã€‚è¿™ç§å±‚çº§å…³ç³»ï¼Œå°±æ˜¯ä½œç”¨åŸŸé“¾ã€‚

## Event Loop

å•çº¿ç¨‹

> é¢˜ç›®ï¼šè®²è§£ä¸‹é¢çš„ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹å’Œç»“æœ

```js
var a = true;
setTimeout(function() {
  a = false;
}, 100);

while (a) {
  console.log("while æ‰§è¡Œäº†");
}
```

è¿™æ®µä»£ç ä¼šä¸€ç›´è¾“å‡º 'while æ‰§è¡Œäº†'ã€‚ JS æ˜¯å•çº¿ç¨‹çš„ï¼Œå…ˆè·‘æ‰§è¡Œæ ˆé‡Œçš„åŒæ­¥ä»»åŠ¡ï¼Œç„¶åå†è·‘ä»»åŠ¡é˜Ÿåˆ—çš„å¼‚æ­¥ä»»åŠ¡ã€‚

### æ‰§è¡Œæ ˆå’Œä»»åŠ¡é˜Ÿåˆ—

> é¢˜ç›®ï¼š è¯´ä¸€ä¸‹ JS ä¸­çš„äº‹ä»¶å¾ªç¯

1. JS æ˜¯å•çº¿ç¨‹ï¼Œå…¶ä¸Šé¢çš„æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯åœ¨ä¸¤ä¸ªåœ°æ–¹æ‰§è¡Œï¼šæ‰§è¡Œæ ˆå’Œä»»åŠ¡é˜Ÿåˆ—ã€‚å‰è€…æ˜¯å­˜æ”¾åŒæ­¥ä»»åŠ¡ï¼›**åè€…æ˜¯å¼‚æ­¥ä»»åŠ¡æœ‰ç»“æœåï¼Œå°±å°†å…¶æ”¾å…¥ä¸€ä¸ªäº‹ä»¶**ã€‚
2. å½“æ‰§è¡Œæ ˆçš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº†ï¼ˆæ ˆç©ºï¼‰ï¼ŒJS ä¼šè¯»å–å¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶å°†å¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸¢åˆ°æ‰§è¡Œæ ˆä¸­æ‰§è¡Œã€‚
3. æ•´ä¸ªè¿‡ç¨‹æ˜¯å¾ªç¯æ‰§è¡Œï¼Œæ‰€ä»¥ç§°ä¹‹äº‹ä»¶å¾ªç¯ã€‚

## æ‰§è¡Œä¸Šä¸‹æ–‡

> é¢˜ç›®ï¼š è§£é‡Šä¸‹â€œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡â€ å’Œ â€œå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡â€

1. å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡

è§£æ JS æ—¶å€™ï¼Œåˆ›å»ºä¸€ä¸ªå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ ç¯å¢ƒã€‚æŠŠä»£ç ä¸­å³å°†æ‰§è¡Œçš„ ï¼ˆå†…éƒ¨å‡½æ•°ä¸ç®—ï¼Œå› ä¸ºä½ ä¸çŸ¥é“å‡½æ•°ä½•æ—¶æ‰§è¡Œï¼‰å˜é‡ï¼Œå‡½æ•°å£°æ˜éƒ½æ‹¿å‡ºæ¥ã€‚æœªèµ‹å€¼çš„å˜é‡å°±æ˜¯ undefinedã€‚

ä¸‹é¢è¿™æ®µä»£ç è¾“å‡ºï¼šundefinedï¼›è€Œä¸æ˜¯æŠ›å‡º Errorã€‚å› ä¸ºåœ¨è§£æ JS çš„æ—¶å€™ï¼Œå˜é‡ a å·²ç»å­˜å…¥äº†å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­äº†ã€‚

```js
console.log(a);
var a = 1;
```

2. å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡

ç›¸æ¯”å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å¤šäº† this å’Œ arguments å’Œå‚æ•°ã€‚
åœ¨ JS ä¸­ï¼Œ this æ˜¯å…³é”®å­—ï¼Œå®ƒä½œä¸ºå†…ç½®å˜é‡ï¼Œå…¶å€¼æ˜¯åœ¨æ‰§è¡Œæ—¶ç¡®å®šçš„ï¼ˆè€Œä¸æ˜¯å®šä¹‰æ—¶ç¡®å®šçš„ï¼‰ã€‚

## é—­åŒ…çš„ç†è§£å’Œåˆ†æ

> é¢˜ç›®ï¼š è§£é‡Šä¸‹ js çš„é—­åŒ…

é—­åŒ…æ˜¯å‡½æ•°å’Œå£°æ˜è¯¥å‡½æ•°çš„è¯æ³•ç¯å¢ƒçš„ç»„åˆã€‚

JS çš„å‡½æ•°è¿è¡Œåœ¨å®ƒä»¬è¢«å®šä¹‰çš„ä½œç”¨åŸŸï¼Œè€Œä¸æ˜¯å®ƒä»¬è¢«æ‰§è¡Œæ—¶çš„ä½œç”¨åŸŸã€‚

> é¢˜ç›®ï¼š é—­åŒ…ä¼˜ç¼ºç‚¹

é—­åŒ…å¯ä»¥éšè—ä¿¡æ¯ï¼Œæœ‰æ•ˆé˜²æ­¢å˜é‡å…¨å±€æ±¡æŸ“ï¼Œä½†åŒæ—¶ä¹Ÿå­˜åœ¨å†…å­˜æ³„æ¼çš„é£é™©ï¼š

- æµè§ˆå™¨å¯ä»¥é€šè¿‡å¼ºåˆ¶åˆ·æ–°è§£å†³ï¼Œå¯¹ç”¨æˆ·ä½“éªŒå½±å“ä¸å¤§
- åœ¨æœåŠ¡ç«¯ï¼Œç”±äº node çš„å†…å­˜é™åˆ¶å’Œç´¯ç§¯æ•ˆåº”ï¼Œå¯èƒ½ä¼šé€ æˆè¿›ç¨‹é€€å‡ºç”šè‡³æœåŠ¡å™¨æ²“æœº

è§£å†³åŠæ³•ï¼Œå°±æ˜¯æ˜¾ç¤ºæš´éœ²ä¸€ä¸ªæ¥å£ï¼Œä¸“é—¨ç”¨ä»¥æ¸…ç†å˜é‡ï¼›

```js
function mockData() {
  const mem = {};
  return {
    clear: () => (mem = null), // æ˜¾å¼æš´éœ²æ¸…ç†æ¥å£
    get: page => {
      if (page in mem) {
        return mem[page];
      }
      mem[page] = Math.random();
    }
  };
}
```

## æ­£åˆ™è¡¨è¾¾å¼

```js
const pattern = /runoob/gi; // æ­£åˆ™è¡¨è¾¾å¼
const str = "Visit Runoob!runoob"; // å¾…åŒ¹é…å­—ç¬¦ä¸²

// Return: Number ä»£è¡¨æœç´¢åˆ°çš„å¼€å§‹åœ°å€
console.log(str.search(/Runoob/i));

// Return: Array åŒ¹é…å‡ºæ¥çš„æ‰€æœ‰å­—ç¬¦ä¸²
console.log(str.match(/run/gi));

// Return: æ–°çš„stringå¯¹è±¡
console.log(str.replace(/visit/i, "visit"));

// Return: Boolean ä»£è¡¨æ˜¯å¦ç¬¦åˆåŒ¹é…
console.log(pattern.test(str));

// Return: æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„å€¼ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾ç€åŒ¹é…ä¿¡æ¯
console.log(pattern.exec(str));
```

## å®ç°åƒåˆ†ä½æ ‡æ³¨

> é¢˜ç›®ï¼š å®ç°åƒåˆ†ä½æ ‡æ³¨ä½ï¼Œè€ƒè™‘å°æ•°ã€è´Ÿæ•°å’Œæ•´æ•°ä¸‰ç§æƒ…å†µã€‚

```js
/**
 * å®ç°åƒåˆ†ä½æ ‡æ³¨ä½
 * @param {*} str å¾…æ ‡æ³¨çš„å­—ç¬¦ä¸²
 * @param {*} sep æ ‡æ³¨ç¬¦å·
 */

const addSeparator = (str = "", sep = ",") => {
  str += "";
  const arr = str.split("."),
    re = /(\d+)(\d{3})/;

  let integer = arr[0],
    decimal = arr.length <= 1 ? "" : `.${arr[1]}`;

  while (re.test(integer)) {
    integer = integer.replace(re, "$1" + sep + "$2");
  }

  return integer + decimal;

  console.log(addSeparator(-10000.23)); // -10,000.23
  console.log(addSeparator(100)); // 100
  console.log(addSeparator(1234, ";")); // 1;234
};
```

```js
const str = "google";
const re = /o/g;

console.log(re.test(str), re.lastIndex); // true 2
console.log(re.test(str), re.lastIndex); // true 3
console.log(re.test(str), re.lastIndex); // false 0
```

> é¢˜ç›®ï¼š å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªå‡ºç°ä¸€æ¬¡çš„å­—ç¬¦

```js
const find_ch = str => {
    for (let ch of str){
        cosnt re = new RegExp(ch,'g');
        if(str.match(re).length === 1){
            return ch;
        }
    }
}
// è¾“å‡ºç­”æ¡ˆæ˜¯ l
console.log(find_ch("google"));
```

## æ‰‹åŠ¨æ’¸ä¸ª call/apply/bind

```js
//  å®ç° call
function test (arg1,arg2){
    console.log(arg1,arg2);
    console.log(this.a,this.b);
}

ran.call({
    {
    a: "a",
    b: "b"
    },
    1,
    2
});
```

**å¦‚æœä¸€ä¸ªå‡½æ•°ä½œä¸ºä¸€ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œé‚£ä¹ˆé€šè¿‡å¯¹è±¡çš„.è¿ç®—ç¬¦è°ƒç”¨æ­¤å‡½æ•°ï¼Œthis å°±æ˜¯æ­¤å¯¹è±¡**

```js
let obj = {
  a: "a",
  b: "b",
  test(arg1, arg2) {
    console.log(arg1, arg2);
    console.log(this.a, this.b); // a b
  }
};

obj.test(1, 2);
```

æ¨¡æ‹Ÿ call

```js
Function.prototype.call2 = function(context) {
  if (typeof this !== "function") {
    throw new TypeError("Error");
  }

  // é»˜è®¤ä¸Šä¸‹æ–‡æ˜¯window
  context = context || window;
  // ä¿å­˜é»˜è®¤çš„fn
  const { fn } = context;

  context.fn = this;
  const args = [...arguments].slice(1);
  // å‰é¢è®²çš„å…³é”®ï¼Œå°†å‡½æ•°æœ¬èº«ä½œä¸ºå¯¹è±¡contextçš„å±æ€§è°ƒç”¨ï¼Œè‡ªåŠ¨ç»‘å®šthis
  const result = context.fn(...args);

  // æ¢å¤é»˜è®¤çš„fn
  context.fn = fn;
  return result;
};

// ä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç 
function test(arg1, arg2) {
  console.log(arg1, arg2);
  console.log(this.a, this.b);
}

test.call2(
  {
    a: "a",
    b: "b"
  },
  1,
  2
);
```

// å°±æ˜¯ä¼šç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ª fn çš„å±æ€§ï¼Œç„¶åé€šè¿‡ context æ¥è°ƒç”¨è‡ªåŠ¨ç»‘å®š this.

### å®ç° apply

```js
Function.prototype.apply2 = function(context) {
  if (typeof this !== "function") {
    throw new TypeError("Error");
  }

  context = context || window;
  const { fn } = context;

  context.fn = this; // ä½œä¸ºå¯¹è±¡çš„å±æ€§è°ƒç”¨ï¼Œè‡ªåŠ¨ç»‘å®šthis
  let result;
  if (Array.isArray(arguments[1])) {
    // é€šè¿‡...è¿ç®—ç¬¦å°†æ•°ç»„è½¬æ¢ä¸ºç”¨é€—å·åˆ†éš”çš„å‚æ•°åºåˆ—
    result = context.fn(...arguments[1]);
  } else {
    result = context.fn();
  }

  context.fn = fn;
  return result;
};

/**
 * ä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç 
 */

function test(arg1, arg2) {
  console.log(arg1, arg2);
  console.log(this.a, this.b);
}

test.apply2(
  {
    a: "a",
    b: "b"
  },
  [1, 2]
);
```

### å®ç° bind

bind ç‰¹ç‚¹

- æœ¬èº«è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œæ‰€ä»¥è¦è€ƒè™‘ new çš„æƒ…å†µ
- å¯ä»¥'ä¿ç•™'å‚æ•°ï¼Œå†…éƒ¨å®ç°äº†å‚æ•°çš„æ‹¼æ¥

```js
Function.prototype.bind2 = function(context) {
  if (typeof this !== "function") {
    throw new TypeError("Error");
  }

  const that = this;
  // ä¿ç•™ä¹‹å‰çš„å‚æ•°ï¼Œä¸ºäº†ä¸‹é¢çš„å‚æ•°æ‹¼æ¥
  const args = [...arguments].slice(1);
  // ä¸¤ä¸ªé—­åŒ…å˜é‡ that å’Œ args
  return function F() {
    // å¦‚æœè¢«newåˆ›å»ºå®ä¾‹ï¼Œä¸ä¼šè¢«æ”¹å˜ä¸Šä¸‹æ–‡ï¼
    if (this instanceof F) {
      console.log(123456);
      return new that(...args, ...arguments);
    }

    // args.concat(...arguments): æ‹¼æ¥ä¹‹å‰å’Œç°åœ¨çš„å‚æ•°
    // æ³¨æ„ï¼šargumentsæ˜¯ä¸ªç±»Arrayçš„Object, ç”¨è§£æ„è¿ç®—ç¬¦..., ç›´æ¥æ‹¿å€¼æ‹¼æ¥
    // å†…éƒ¨ç”± apply æ¥ç®¡å‡½æ•°çš„è°ƒç”¨

    return that.apply(context, args.concat(...arguments));
  };
};

/**
 * ä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç 
 */

function test(arg1, arg2) {
  console.log(arg1, arg2);
  console.log(this.a, this.b);
}

const test2 = test.bind2(
  {
    a: "a",
    b: "b"
  },
  1
); // å‚æ•° 1

test2(2); // å‚æ•° 2
```

## åŸºäº ES5/ES6 å®ç°â€œåŒå‘ç»‘å®šâ€

**åŒå‘ç»‘å®š**ï¼š è§†å›¾ view çš„å˜åŒ–èƒ½å®æ—¶è®©æ•°æ®æ¨¡å‹ (Model) å‘ç”Ÿå˜åŒ–ï¼Œè€Œæ•°æ®çš„å˜åŒ–ä¹Ÿèƒ½å®æ—¶æ›´æ–°åˆ°è§†å›¾å±‚ã€‚

**å•é¡¹æ•°æ®ç»‘å®š**ï¼š åªæœ‰ä»æ•°æ®åˆ°è§†å›¾è¿™ä¸€æ–¹å‘çš„å…³ç³»ã€‚

### ES5 çš„ Object.definedPrototype

````js
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script>
        // æ¨¡å‹
        const obj = {
          value: ''
        };

        function onkeyUp(event) {
            obj.value = event.target.value;
        }

        // å¯¹ obj.value  è¿›è¡Œæ‹¦æˆª
        Object.defineProperty(obj,'value',{
            get () {
                return value;
            },
            set (newValue) {
                value = newValue;
                document.querySelector('#value').innerHTMl = newValue; //æ›´æ–°è§†å›¾å±‚
                document.qerySelector('input').value = newValue; // æ•°æ®æ¨¡å‹æ”¹å˜
            }
        })
    </script>
  </head>
  <body>
    <p>å€¼æ˜¯ï¼š<span id="value"></span></p>
    <input type="text" onkeyup="onKeyUp(event)" />
  </body>
</html>
``

### ES6 çš„ Proxy
vue3.0æ”¾å¼ƒäº†æ”¯æŒ IE æµè§ˆå™¨ï¼Œå› æ­¤åºŸå¼ƒäº† Object.definedPropertyï¼Œé€‰æ‹©ä½¿ç”¨ Proxy æ¥å®ç°æ•°æ®çš„åŒå‘ç»‘å®šã€‚
Proxy èƒ½æ”¯æŒ 13 ç§åŠ«æŒæ“ä½œã€‚
```js
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <script>
    const obj = {};
    const newObj = new Proxy(obj,{
        get(target,key,receiver){
            // è¿”å›å¯¹è±¡çš„é»˜è®¤è¡Œä¸º
            return Reflect.get(target,key,receiver)
        },
        set(target,key,value,receiver){
        // åªé’ˆå¯¹ value å±æ€§åšå…¶ä»–è¡Œä¸º
            if(key === 'value'){
                document.querySelector('#value').innerHTML = value
                document.querySelector('input').value = value
            }
            return Reflect.set(target, key, value, receiver);
        }
    });
    function onKeyUp(event) {
        newObj.value = event.target.value;
    }

  </script>
</head>
<body>
  <p>
    å€¼æ˜¯ï¼š<span id="value"></span>
  </p>
  <input type="text" onkeyup="onKeyUp(event)">
</body>
</html>
````

## instaceof åŸç†ä¸å®ç°

instanceof æ˜¯é€šè¿‡åŸå‹é“¾æ¥è¿›è¡Œåˆ¤æ–­çš„ï¼Œæ‰€ä»¥åªè¦ä¸æ–­åœ°é€šè¿‡è®¿é—® **proto** ï¼Œå°±å¯ä»¥æ‹¿åˆ°æ„é€ å‡½æ•°çš„åŸå‹ã€‚ç›´åˆ° null åœæ­¢ã€‚

```js
/**
 * åˆ¤æ–­leftæ˜¯ä¸æ˜¯rightç±»å‹çš„å¯¹è±¡
 * @param {*} left
 * @param {*} right
 * @return {Boolean}
 */
function instanceof2(left, right) {
  let prototype = right.prototype;

  // æ²¿ç€leftçš„åŸå‹é“¾, çœ‹çœ‹æ˜¯å¦æœ‰ä½•prototypeç›¸ç­‰çš„èŠ‚ç‚¹
  left = left.__proto__;
  while (1) {
    if (left === null || left === undefined) {
      return false;
    }
    if (left === prototype) {
      return true;
    }
    left = left.__proto__;
  }
}

/**
 * æµ‹è¯•ä»£ç 
 */

console.log(instanceof2([], Array)); // output: true

function Test() {}
let test = new Test();
console.log(instanceof2(test, Test)); // output: true
```

## å®ç°æ”¯æŒç»‘å®šã€è§£ç»‘å’Œæ´¾å‘çš„äº‹ä»¶ç±»

> å®ç°æ€è·¯ï¼š è¿™é‡Œæ¶‰åŠäº† â€œè®¢é˜…/å‘å¸ƒâ€ ç›¸å…³çŸ¥è¯†

```js
// æ•°ç»„ç½®ç©ºï¼š
// arr = []; arr.length = 0; arr.splice(0, arr.length)
class Event {
  constructor() {
    this._cache = {};
  }

  // æ³¨å†Œäº‹ä»¶ï¼šå¦‚æœä¸å­˜åœ¨æ­¤ç§typeï¼Œåˆ›å»ºç›¸å…³æ•°ç»„
  on(type, callback) {
    this._cache[type] = this._cache[type] || [];
    let fns = this._cache[type];
    if (fns.indexOf(callback) === -1) {
      fns.push(callback);
    }
    return this;
  }

  // è§¦å‘äº‹ä»¶ï¼šå¯¹äºä¸€ä¸ªtypeä¸­çš„æ‰€æœ‰äº‹ä»¶å‡½æ•°ï¼Œå‡è¿›è¡Œè§¦å‘
  trigger(type, ...data) {
    let fns = this._cache[type];
    if (Array.isArray(fns)) {
      fns.forEach(fn => {
        fn(...data);
      });
    }
    return this;
  }

  // åˆ é™¤äº‹ä»¶ï¼šåˆ é™¤äº‹ä»¶ç±»å‹å¯¹åº”çš„array
  off(type, callback) {
    let fns = this._cache[type];
    // æ£€æŸ¥æ˜¯å¦å­˜åœ¨typeçš„äº‹ä»¶ç»‘å®š
    if (Array.isArray(fns)) {
      if (callback) {
        // å¸è½½æŒ‡å®šçš„å›è°ƒå‡½æ•°
        let index = fns.indexOf(callback);
        if (index != -1) {
          fns.splice(index, 1);
        }
      } else {
        // ä¸æŒ‡å®š callback æ¸…ç©ºå…¨éƒ¨
        fns = [];
      }
    }
    return this;
  }
}

// ä»¥ä¸‹æ˜¯æµ‹è¯•å‡½æ•°

const event = new Event();
event
  .on("test", a => {
    console.log(a);
  })
  .trigger("test", "hello");
```

## Typescript

> æš‚å®š

## ES6

### å…³äº Promise

- Promise å®ä¾‹ä¸€æ—¦è¢«åˆ›å»ºå°±ä¼šè¢«æ‰§è¡Œ (ä¸€èˆ¬åšæ³•æ˜¯å°è£…ä¸€å±‚å¤–éƒ¨å‡½æ•°)
- Promise è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªåˆ†æ”¯ï¼š pending=>resolved å’Œ pending=>rejected;
- Promise çŠ¶æ€å‘é€æ”¹å˜åï¼Œä¾æ—§ä¼šæ‰§è¡Œä¹‹åçš„ä»£ç ï¼›

### then

```js
let t = new Promise(() => {});
t.__proto__;

function func(args) {
    // å¿…é¡»è¿”å›ä¸€ä¸ªPromiseå®ä¾‹
    return new Promise((resolve,reject)=>{
        if(...){
            resolve(...) // ä¼ å…¥resolveå‡½æ•°çš„å‚æ•°
        } else {
            let err = new Error(...)
            reject(err) // rejectå‚æ•°å¿…é¡»æ˜¯Errorå¯¹è±¡
        }
    })
}

func(ARGS).then(()=>{
    // resolve å‡½æ•°
},()=>{
    // reject å‡½æ•°
})

//  è¿ç»­è°ƒç”¨ then

func(ARGS).then(()=>{
    ... // then ä¹‹åè¿”å›å¦ä¸€ä¸ª promise å¯¹è±¡
}).then(
    ()=>{ ... },
    () => { ... }
)

function helloWorld(read) {
    return new Promise((resolve,reject) => {
        if (read) {
            resolve('Right');
        } else {
            let error = new Error('arg is false');
            reject(error); //  ä¼ å…¥ Error å¯¹è±¡
        }
    })
}

helloWorld(false).then(
  msg => {
    // trueï¼šhelloWorldçš„å‚æ•°
    // å‚æ•°msgï¼šåœ¨ä¸Šé¢çš„Promiseå¯¹è±¡ä¸­ä¼ å…¥äº†
    console.log(msg);
  },
  error => {
    console.log(error.message);
  }
);

// catch

function func(args) {
    // å¿…é¡»è¿”å›ä¸€ä¸ªPromiseå®ä¾‹
    const promise =  new Promise((resolve,reject)=>{
        if(...){
            resolve(...)
        } else {
            let err = new Error(...)
            reject(err)
        }
    })
    return promise
}

func(ARGS).then(()=>{
    // resolve å‡½æ•°
}).catch(()=>{
    // reject å‡½æ•°
}).then(()=>{
    // æ²¡æœ‰é”™è¯¯å°±ä¼šè·³è¿‡ä¸Šé¢çš„catch
}).finally(){
    // ä¸ç®¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œ
}
```

### all æ–¹æ³•

```js
const p = Promise.all([p1, p2, p3]); // pæ˜¯æ–°åŒ…è£…å¥½çš„ä¸€ä¸ªPromiseå¯¹è±¡
const databasePromise = connectDatabase();

const booksPromise = databasePromise.then(findAllBooks);

const userPromise = databasePromise.then(getCurrentUser);

Promise.all([booksPromise, userPromise]).then(([books, user]) =>
  pickTopRecommentations(books, user)
);

// æ‰€æœ‰çš„promiseå®ä¾‹çš„çŠ¶æ€éƒ½è½¬å˜æˆ fulfilledã€‚
```

å¦å¤–ä¸€ä¸ªä¾‹å­

```js
"use strict";
const p1 = new Promise((resolve, reject) => {
  resolve("hello");
})
  .then(result => result)
  .catch(e => e);

const p2 = new Promise((resolve, reject) => {
  throw new Error("p2 error");
})
  .then(result => result)
  .catch(
    // å¦‚æœæ³¨é‡Šæ‰ catchï¼Œè¿›å…¥æƒ…å†µ2
    // å¦åˆ™ï¼Œæƒ…å†µ1
    e => e.message
  );

Promise.all([p1, p2])
  .then(
    result => console.log(result) // æƒ…å†µ1
  )
  .catch(
    e => console.log("error in all") // æƒ…å†µ2
  );
```

**å¯¹äºæ¯ä¸ª Promise å¯¹è±¡ï¼Œä¸€æ—¦è¢«å®ƒè‡ªå·±çš„å®šä¹‰çš„ catch æ–¹æ³•æ•è·å¼‚å¸¸ï¼Œé‚£ä¹ˆçŠ¶æ€å°±ä¼šæ›´æ–°ä¸º fulfilled è€Œä¸æ˜¯ failed**

### race

```js
//è€Œä¸”åªè¦æœ‰ä¸€ä¸ªçŠ¶æ€è¢«æ”¹å˜ï¼Œé‚£ä¹ˆæ–°çš„PromiseçŠ¶æ€ä¼šç«‹å³æ”¹å˜
const p = Promise.race([
  fetch("/resource-that-may-take-a-while"),
  new Promise(function(resolve, reject) {
    setTimeout(() => reject(new Error("request timeout")), 5000);
  })
]);
p.then(response => console.log(response));
p.catch(error => console.log(error));
```

### çŠ¶æ€åªæ”¹å˜ä¸€æ¬¡

```js
"use strict";

const promise = new Promise((resolve, reject) => {
  resolve("ok"); // çŠ¶æ€å˜æˆ resolved
  throw new Error("test"); // Promise çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜ï¼Œå°±æ°¸ä¹…ä¿æŒè¯¥çŠ¶æ€
});
promise
  .then(val => {
    console.log(val);
  })
  .catch(error => {
    console.log(error.message); // æ‰€ä»¥ï¼Œæ— æ³•æ•è·é”™è¯¯
  });
```

æ²¡æœ‰æ˜¾ç¤ºè‡ªå®šä¹‰ catchï¼Œé”™è¯¯å°†è¢«åƒæ‰ã€‚

```js
"use strict";

const someAsyncThing = function() {
  return new Promise(function(resolve, reject) {
    // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºxæ²¡æœ‰å£°æ˜
    resolve(x + 2);
  });
};

someAsyncThing().then(function() {
  console.log("everything is great");
});

setTimeout(() => {
  console.log(123);
}, 2000);

// ä¿®æ”¹ä¸Šé¢çš„ä¾‹å­

someAsyncThing()
  .then(function() {
    return someOtherAsyncThing();
  })
  .catch(function(error) {
    console.log("oh no", error);
    // ä¸‹é¢ä¸€è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸ºyæ²¡æœ‰å£°æ˜
    y + 2;
  })
  .catch(function(error) {
    console.log("carry on", error);
  });
// oh no [ReferenceError: x is not defined]
// carry on [ReferenceError: y is not defined]
```

## ES6 é‡ç‚¹

ğŸ‘‡ å†…å®¹é€Ÿè§ˆ ğŸ‘‡

- let å’Œ const
- Set å’Œ Map
- Generator å’Œ yield
- Promise/async/await
- Proxy
- ...

```js
// ä¿è¯æ•°æ®ç»“æ„ä¸å¯å˜
/**
 * å†»ç»“å¯¹è±¡
 * @param {Object} obj
 * @return {Object}
 */

function constantize(obj) {
  // åˆ¤æ–­å¯¹è±¡æ˜¯å¦è¢«å†»ç»“
  if (Object.isFrozen(obj)) {
    return obj;
  }

  Reflect.ownKeys(obj).forEach(key => {
    typeof obj[key] === "object" && (obj[key] = constantize(obj[key]));
  });

  return Object.freeze(obj); // å†»ç»“å¯¹è±¡, freezeåªèƒ½å†»ç»“åˆ°å¤–å±‚
}

/********æµ‹è¯•ä»£ç  **********/

const obj = {
  a: 1,
  b: {
    c: 2,
    d: {
      a: 1
    }
  },
  d: [1, 2]
};

const fronzenObj = constantize(obj);
try {
  fronzenObj.d = [];
  fronzenObj.b.c = 3;
} catch (error) {
  console.log(error.message);
}
```

### Set å’Œ Map

- Set å…ƒç´ ä¸å…è®¸é‡å¤
- Map å’Œ å¯¹è±¡ç±»ä¼¼ï¼Œä½†å®ƒçš„é”®æ”¯æŒä»»ä½•æ•°æ®ç±»å‹

```js
// å®ä¾‹åŒ–ä¸€ä¸ªset
const set = new Set([1, 2, 3, 4]);

// éå†set
for (let item of set) {
  console.log(item);
}

// æ·»åŠ å…ƒç´ ï¼Œè¿”å›Setæœ¬èº«
set.add(5).add(6);

// Setå¤§å°
console.log(set.size);

// æ£€æŸ¥å…ƒç´ å­˜åœ¨
console.log(set.has(0));

// åˆ é™¤æŒ‡å®šå…ƒç´ ï¼Œè¿”å›bool
let success = set.delete(1);
console.log(success);

set.clear();

for (let item of set.keys()) {
  console.log(item);
}

for (let item of set.values()) {
  console.log(item);
}

for (let item of set.entries()) {
  console.log(item);
}
```

Map æ¥å£åŸºæœ¬å’Œ Set ä¸€è‡´ã€‚ä¸åŒçš„æ˜¯å¢åŠ æ–°å…ƒç´ çš„ API æ˜¯ï¼šset(key, value)

```js
const map = new Map();

// ä»¥ä»»æ„å¯¹è±¡ä¸º Key å€¼
// è¿™é‡Œä»¥ Date å¯¹è±¡ä¸ºä¾‹
let key = new Date();
map.set(key, "today");

console.log(map.get(key));
```

### Geneartor ä¸ yield

```js
function* foo(x) {
  var y = 2 * (yield x + 1);
  var z = yield y / 3;
  return x + y + z;
}

var b = foo(5);
b.next(); // { value:6, done:false }
b.next(12); // { value:8, done:false }
b.next(13); // { value:42, done:true }
```

æ‰§è¡Œè¿‡ç¨‹:

- ç»™å‡½æ•° foo ä¼ å…¥å‚æ•° 5ï¼Œä½†ç”±äºå®ƒæ˜¯ geneartorï¼Œæ‰€ä»¥æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª yield å‰å°±åœæ­¢äº†ã€‚
- ç¬¬ä¸€æ¬¡è°ƒç”¨ next()ï¼Œè¿™æ¬¡ä¼ å…¥çš„å‚æ•°ä¼šè¢«å¿½ç•¥æš‚åœ\*\*ã€‚
- ç¬¬äºŒæ¬¡è°ƒç”¨ next(12)ï¼Œä¼ å…¥å‚æ•°ä¼šè¢«å½“æˆç¬¬ä¸€ä¸ª yield è¡¨è¾¾å¼çš„è¿”å›å€¼ã€‚å› æ­¤ y = 2 \* 12 = 24ã€‚æ‰§è¡Œåˆ°ç¬¬äºŒä¸ª yieldï¼Œè¿”å›å…¶åçš„è¡¨è¾¾å¼çš„å€¼ 24 / 3 = 8ã€‚ç„¶åå‡½æ•°åœ¨æ­¤å¤„åœæ­¢ã€‚
- ç¬¬ä¸‰æ¬¡è°ƒç”¨ next(13)ã€‚ æ²¡æœ‰äº† yield ï¼Œåªå‰©ä¸‹äº† return ï¼ŒæŒ‰ç…§æ­£å¸¸å‡½æ•°è¿”å› return è¡¨è¾¾å¼åé¢çš„å€¼ï¼Œå¹¶ä¸” done ä¸º trueã€‚

**éš¾ç‚¹** ä¸ºä»€ä¹ˆæœ€åè¿”å›çš„å€¼æ˜¯ 42 ?

x ç­‰äºå‡½æ•°åˆå§‹åŒ–çš„ 5ï¼Œè€Œ 13 å€å½“æˆç¬¬äºŒä¸ª yield çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ z æ˜¯ 13,y = 2 \* 12 = 24ã€‚ 5 + 24 + 13 = 42

```js
// å¦å¤–ä¸€ä¸ªä¾‹å­
function* foo(x) {
  var y = 2 * (yield x + 1);
  var z = yield y / 3;
  return x + y + z;
}

var a = foo(5);
a.next(); // Object{value:6, done:false}
a.next(); // Object{value:NaN, done:false}
a.next(); // Object{value:NaN, done:true}
```

åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨ next å‡½æ•°çš„æ—¶å€™ï¼Œè¾“å‡ºçš„ value æ˜¯ 6ã€‚å…¶ä»–æ—¶å€™ç”±äºæ²¡æœ‰ next ä¼ å…¥å‚æ•°ï¼Œå› æ­¤ yield åé¢çš„è¡¨è¾¾å¼çš„è¿”å›å€¼éƒ½æ˜¯ undefinedï¼Œè¿›è¡Œè¿ç®—åå°±å˜æˆäº† NaNã€‚

### Promise æ€»ç»“

- ä¸‰ä¸ªçŠ¶æ€ pending/fulfilled/rejected
- ä¸¤ä¸ªè¿‡ç¨‹(å•é¡¹ä¸å¯é€†):
  - pending -> fulfilled
  - pending -> rejected
- ä¸€ä¸ªæ–¹æ³• then: Promise æœ¬è´¨åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œ catch å’Œ all æ–¹æ³•éƒ½æ˜¯åŸºäº then æ–¹æ³•å®ç°çš„ã€‚

```js
// æ„é€  Promise æ—¶å€™, å†…éƒ¨å‡½æ•°ç«‹å³æ‰§è¡Œ
new Promise((resolve, reject) => {
  console.log("new Promise");
  resolve("success");
});

console.log("finifsh");

// then ä¸­ ä½¿ç”¨äº† return ï¼Œé‚£ä¹ˆ return çš„å€¼ä¼šè¢« Promise.resolve() åŒ…è£…

Promise.resolve(1)
  .then(res => {
    console.log(res); // 1
    return 2; // åŒ…è£…æˆ Promise.resolve(2)
  })
  .then(res => {
    console.log(res); // 2
  });
```

### async/await

async å‡½æ•°è¿”å›ä¸€ä¸ª promise å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ then æ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚å½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€æ—¦é‡åˆ° await å°±ä¼šå…ˆè¿”å›ï¼Œç­‰åˆ°å¼‚æ­¥æ“ä½œå®Œæˆåï¼Œå†æ¥ç€æ‰§è¡Œå‡½æ•°ä½“åé¢çš„è¯­å¥ã€‚

```js
function sleep(millisecond){
    return new promise(resolve => {
        setTimeout(() => resolve,millisecond);
    })
}

/**
 * ä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç 
 */

 async function test(){
     // ä»£ç çœ‹èµ·æ¥è·ŸåŒæ­¥ä»£ç ä¸€æ ·
     console.log('start');
     await sleep(1000); // ç¡çœ 1s
     console.log('end')ï¼›
 }

 test();
```

**ä¸€äº›å¼‚æ­¥å¹¶å‘æ“ä½œï¼Œæˆ‘ä»¬è¿˜æ˜¯åªèƒ½ä½¿ç”¨ Promise.all æ¥å®ç°,async åªèƒ½å®ç°ä¸²è¡Œæ‰§è¡Œ**

```js
function sleep(second) {
  return new Promise(resolve => {
    setTimeout(() => {
      console.log(Math.random());
      resolve();
    }, second);
  });
}

async function chuanXingDemo() {
  // ä¸²è¡Œæ‰§è¡Œ
  await sleep(1000);
  await sleep(1000);
  await sleep(1000);
}

async function bingXingDemo() {
  var tasks = [];
  for (let i = 0; i < 3; ++i) {
    tasks.push(sleep(1000));
  }

  // å¹¶è¡Œæ‰§è¡Œ
  await Promise.all(tasks);
}
```

## ES6 å¯¹è±¡å’Œ ES5 å¯¹è±¡

> é¢˜ç›®: es6 class çš„ new å®ä¾‹å’Œ es5 çš„ new å®ä¾‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

es6,clss çš„ new çš„å®ä¾‹æœ‰ä¸€ä¸‹ç‰¹ç‚¹ï¼š

- class çš„æ„é€ å‚æ•°å¿…éœ€æ˜¯ new è°ƒç”¨ï¼Œä¸å¯å°†å…¶ä½œä¸ºæ™®é€šå‡½æ•°æ‰§è¡Œ
- es6 çš„ class ä¸å­˜åœ¨å˜é‡æå‡
- **class å†…éƒ¨çš„æ–¹æ³•ä¸å¯æšä¸¾**

```js
console.log(ES5Class()); // es5:å¯ä»¥ç›´æ¥ä½œä¸ºå‡½æ•°è¿è¡Œ
// console.log(new ES6Class()) // ä¼šæŠ¥é”™ï¼šä¸å­˜åœ¨å˜é‡æå‡

function ES5Class() {
  console.log("hello");
}

ES5Class.prototype.func = function() {
  console.log("Hello world");
};

class ES6Class {
  constructor() {}
  func() {
    console.log("Hello world");
  }
}

let es5 = new ES5Class();
let es6 = new ES6Class();

// æ¨èåœ¨å¾ªç¯å¯¹è±¡å±æ€§çš„æ—¶å€™ï¼Œä½¿ç”¨for...in
// åœ¨éå†æ•°ç»„çš„æ—¶å€™çš„æ—¶å€™ï¼Œä½¿ç”¨for...of
console.log("ES5 :");
for (let _ in es5) {
  console.log(_);
}

// es6:ä¸å¯æšä¸¾
console.log("ES6 :");
for (let _ in es6) {
  console.log(_);
}
```

## Proxy ä»£ç†å™¨

Proxy å¯ä»¥å®ç°å…ƒç¼–ç¨‹ï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾æ‹¦æˆªï¼Œå¯ä»¥è¿‡æ»¤å’Œä¿®æ”¹å¤–éƒ¨çš„è®¿é—®ã€‚

```js
// æ‹¦æˆªå™¨
const handler = {
  // receiver æŒ‡å‘ proxy å®ä¾‹
  get(target, property, receiver) {
    console.log(`GET: target is ${target}, property is ${property}`);
    return Reflect.get(target, property, receiver);
  },
  set(target, property, value, receiver) {
    console.log(`SET: target is ${target}, property is ${property}`);
    return Reflect.set(target, property, value);
  }
};

// ç›®æ ‡å“¦å¯¹è±¡
const obj = { a: 1, b: { c: 0, d: { e: -1 } } };
const newObj = new Proxy(obj, handler);

/**
 * ä»¥ä¸‹æ˜¯æµ‹è¯•ä»£ç 
 */

newObj.a; // output: GET...
newObj.b.c; // output: GET...

newObj.a = 123; // output: SET...
newObj.b.c = -1; // output: GET...  å¯¹äºæ·±å±‚æ¬¡çš„å±æ€§éœ€è¦ä¸“é—¨å¯¹å…¶è®¾ç½® proxy
```

## EsModule å’Œ CommonJS çš„æ¯”è¾ƒ

ç›®å‰ js ç¤¾åŒºæœ‰ 4 ç§æ¨¡å—ç®¡ç†è§„èŒƒ ï¼š AMD/CMD/CommonJS/EsModule.

åŒºåˆ«:

- CommonJS æ”¯æŒåŠ¨æ€å¯¼å…¥ require(\*\*\*)ï¼Œåè€…ä¸æ”¯æŒï¼Œä½†å·²ææ¡ˆ
- CommonJs æ˜¯åŒæ­¥å¯¼å…¥ï¼ŒNode ç¯å¢ƒä¸­ï¼Œæ–‡ä»¶éƒ½åœ¨æœ¬åœ°ï¼ŒåŒæ­¥å¯¼å…¥å³æ—¶å¡ä¸»ä¸»çº¿ç¨‹å½±å“ä¹Ÿä¸å¤§ã€‚è€Œåè€…æ˜¯å¼‚æ­¥å¯¼å…¥ï¼Œå› ä¸ºç”¨äºæµè§ˆå™¨ç«¯ï¼Œéœ€è¦ä¸‹è½½æ–‡ä»¶ï¼Œå¦‚æœé‡‡ç”¨åŒæ­¥å¯¼å…¥ä¼šå¯¹æ¸²æŸ“æœ‰è¾ƒå¤§çš„å½±å“ã€‚
- CommonJs è¾“å‡ºçš„å€¼æ˜¯æµ…æ‹·è´ï¼Œ EsModule è¾“å‡ºçš„å€¼æ˜¯å¼•ç”¨
- ES Module ä¼šç¼–è¯‘æˆ require/exports æ¥æ‰§è¡Œçš„

## promise/async/await çš„æ‰§è¡Œé¡ºåº

```js
console.log("script start"); // 1

async function async1() {
  await async2();
  console.log("async1 end"); // 7
}

async function async2() {
  console.log("async2 end"); // 2
}
async1();

setTimeout(function() {
  console.log("setTimeout"); // 8
}, 0);

new Promise(resolve => {
  console.log("Promise"); // 3
  resolve();
})
  .then(function() {
    console.log("promise1"); // 5
  })
  .then(function() {
    console.log("promise2"); // 6
  });

console.log("script end"); // 4
```

æ‰§è¡Œè¿‡ç¨‹:

1. æ­£å¸¸è¾“å‡º script start
2. æ‰§è¡Œ async1 å‡½æ•°ï¼Œæ­¤å‡½æ•°ä¸­åˆè°ƒç”¨äº† async2 å‡½æ•°ï¼Œè¾“å‡º async2 endã€‚å›åˆ° async1 å‡½æ•°ï¼Œé‡åˆ°äº† awaitï¼Œè®©å‡ºçº¿ç¨‹ã€‚
3. é‡åˆ° setTimeoutï¼Œ**æ‰”åˆ°ä¸‹ä¸€è½®å®ä»»åŠ¡é˜Ÿåˆ—**
4. é‡åˆ° Promise å¯¹è±¡ï¼Œç«‹å³æ‰§è¡Œå…¶å‡½æ•°ï¼Œè¾“å‡º Promiseã€‚å…¶åçš„ resolveï¼Œè¢«æ‰”åˆ°äº†å¾®ä»»åŠ¡é˜Ÿåˆ—
5. æ­£å¸¸è¾“å‡º script end
6. æ­¤æ—¶ï¼Œæ­¤æ¬¡ Event Loop å®ä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº†ã€‚æ¥çœ‹ä¸‹ç¬¬äºŒæ­¥è¢«æ‰”è¿›æ¥çš„å¾®ä»»åŠ¡ï¼Œå› ä¸º async2 å‡½æ•°æ˜¯ async å…³é”®è¯ä¿®é¥°ï¼Œå› æ­¤ï¼Œå°† await async2 åçš„ä»£ç æ‰”åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­
7. æ‰§è¡Œç¬¬ 4 æ­¥è¢«æ‰”åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œè¾“å‡º promise1 å’Œ promise2
8. æ‰§è¡Œç¬¬ 6 æ­¥è¢«æ‰”åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡ï¼Œè¾“å‡º async1 end
9. ç¬¬ä¸€è½® EventLoop å®Œæˆï¼Œæ‰§è¡Œç¬¬äºŒè½® EventLoopã€‚æ‰§è¡Œ setTimeout ä¸­çš„å›è°ƒå‡½æ•°ï¼Œè¾“å‡º setTimeoutã€‚

```js
// æ–°çš„async2å‡½æ•°
function async2() {
  console.log("async2 end");
}
```

è¾“å‡ºç»“æœ

```js
script start
async2 end
Promise
script end
async1 end
promise1
promise2
setTimeout
```

**åˆ’é‡ç‚¹**
å¦‚æœ await å‡½æ•°åé¢çš„å‡½æ•°æ˜¯æ™®é€šå‡½æ•°ï¼Œé‚£ä¹ˆå…¶åçš„å¾®ä»»åŠ¡å°±æ­£å¸¸æ‰§è¡Œï¼›å¦åˆ™ï¼Œä¼šå°†å…¶å†æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚
**await å°±æ˜¯è®©å‡ºçº¿ç¨‹ï¼Œå…¶åçš„ä»£ç æ”¾å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆä¸ä¼šå†å¤šä¸€æ¬¡æ”¾å…¥çš„è¿‡ç¨‹ï¼‰ï¼Œå°±è¿™ä¹ˆç®€å•äº†ã€‚**

## æµè§ˆå™¨å¸¸è§è€ƒç‚¹

> é¢˜ç›®ï¼š æµè§ˆå™¨ä»åŠ è½½é¡µé¢åˆ°æ¸²æŸ“é¡µé¢çš„è¿‡ç¨‹ã€‚

### åŠ è½½è¿‡ç¨‹

1. DNS æœåŠ¡å™¨è§£æåŸŸå IP åœ°å€
2. å»ºç«‹ TCP æ¡æ‰‹è¿æ¥
3. å‘ IP æŒ‡å‘çš„æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚
4. æœåŠ¡å™¨æ”¶åˆ°ã€å¤„ç†å¹¶è¿”å› HTTP è¯·æ±‚
5. æµè§ˆå™¨è·å–è¿”å›çš„å†…å®¹

### æ¸²æŸ“è¿‡ç¨‹

- æ ¹æ® HTML ä»£ç  ç”Ÿæˆ DOM æ ‘
- æ ¹æ® css ç”Ÿæˆ CSSDOM
- å°† CSSDOM å’Œ DOM æ•´åˆæˆ RenderTree
- æ ¹æ® RenderTree å¼€å§‹æ¸²æŸ“å’Œå±•ç¤º
- é‡åˆ° `<script>` ä¼šé˜»å¡ä»£ç 

è¿™ä¸ªè¿‡ç¨‹è¦æ³¨æ„ `<link>` æ ‡ç­¾ä½ç½®ï¼Œä»¥åŠ `<script>` æ ‡ç­¾ä½ç½® å’Œ HTML æä¾›çš„ async defer å±æ€§

### æ¸²æŸ“çº¿ç¨‹å’Œ JS å¼•æ“çº¿ç¨‹

æµè§ˆå™¨ä¸­å¸¸è§çš„çº¿ç¨‹æœ‰: æ¸²æŸ“çº¿ç¨‹ã€JS å¼•æ“çº¿ç¨‹ã€HTTP çº¿ç¨‹ç­‰ç­‰ã€‚
ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ª Ajax è¯·æ±‚çš„æ—¶å€™ï¼Œå°±å¯åŠ¨ä¸€ä¸ª HTTP çº¿ç¨‹ã€‚

åŒæ ·åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨çº¿ç¨‹çš„çŸ¥è¯†è§£é‡Šï¼š ä¸ºä»€ä¹ˆç›´æ¥æ“ä½œ DOM ä¼šå˜æ…¢ï¼Œæ€§èƒ½æ¶ˆè€—æ›´å¤§ï¼Ÿå› ä¸º JS å¼•æ“çº¿ç¨‹å’Œæ¸²æŸ“çº¿ç¨‹æ˜¯äº’æ–¥çš„ã€‚è€Œç›´æ¥æ“ä½œ DOM ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªçº¿ç¨‹äº’æ–¥ä¹‹é—´çš„é€šä¿¡ï¼Œæ‰€ä»¥å¼€é”€æ›´å¤§ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜èƒ½è§£é‡Š `<script>` ä¸ºä»€ä¹ˆä¼šé˜»å¡ DOM æ¸²æŸ“ï¼Œæ¯•ç«Ÿ JS æ˜¯å¯ä»¥ä¿®æ”¹ DOM çš„ï¼Œå¦‚æœ JS æ‰§è¡Œçš„æ—¶å€™ UI ä¹Ÿå·¥ä½œï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´ä¸å®‰å…¨çš„æ¸²æŸ“ã€‚

### é‡æµå’Œå›æµ

é‡ç»˜å’Œå›æµè¿˜åœ¨æ ·å¼èŠ‚ç‚¹å˜åŠ¨çš„æ—¶å€™å‡ºç°ï¼Œå›æµæ‰€éœ€è¦çš„æˆæœ¬æ›´å¤§ï¼Œå›æµä¸€å®šä¼šå¼•é‡ç»˜ã€‚
é‡ç»˜åªæ˜¯ä¸€äº›å…ƒç´ å±æ€§æ›´æ–°ï¼Œè¿™äº›å±æ€§åªå½±å“å¤–è§‚ï¼Œä¸å½±å“å¸ƒå±€ã€‚
å›æµæ˜¯å…ƒç´ çš„å°ºå¯¸ã€å¸ƒå±€ã€å¯è§ç­‰å±æ€§å‘ç”Ÿæ”¹å˜ã€‚ä¼šå¯¼è‡´æ¸²æŸ“æ ‘é‡æ–°æ„é€ ã€‚æ¯”å¦‚çª—å£å­—ä½“å¤§å°å˜åŒ–ã€æ ·å¼è¡¨æ”¹åŠ¨ã€å…ƒç´ å†…å®¹ï¼ˆå°¤å…¶æ˜¯è¾“å…¥æ§ä»¶ï¼‰ã€css ä¼ªç±»æ¿€æ´»ã€offsetWidth ç­‰å±æ€§è®¡ç®—ã€‚

### å¦‚ä½•å‡å°‘é‡ç»˜å›æµï¼Ÿ

- ä¸€æ¬¡æ€§æ›´æ”¹ style å±æ€§ï¼Œæˆ–è€…ç›´æ¥å®šä¹‰ class å±æ€§ï¼Œä¸è¦é€æ¡æ›´æ”¹æ ·å¼ã€‚
- é¿å…ç›´æ¥æ’å…¥ DOMã€‚åœ¨ documentFragment ä¸Šæ“ä½œï¼Œç„¶åå†æ’å…¥ document ä¸­
- é¿å…å¾ªç¯è¯»å– offsetWidth ç­‰å±æ€§ã€‚å¾ªç¯å¤–å­˜å–
- é¿å…å¤æ‚åŠ¨ç”»ã€‚åˆ©ç”¨ç»å¯¹å®šä½å°†å…¶è„±ç¦»æ–‡æ¡£æµ
- é¿å… CSS é€‰æ‹©ç¬¦å±‚çº§å¤ªå¤šã€‚å°½é‡å¹³çº§ç±»åï¼Œå‚è€ƒ scss ä¸­çš„&çš„ç”¨æ³•
- ä¸ºé¢‘ç¹é‡ç»˜æˆ–è€…å›æµçš„èŠ‚ç‚¹è®¾ç½®å›¾å±‚ï¼š
- æå‰é€šçŸ¥æµè§ˆå™¨ï¼šwill-change (æµè§ˆå™¨ä¼šæ ¹æ®è¿™ä¸ªå±æ€§è‡ªåŠ¨åˆæˆä½å›¾ä¼˜åŒ–æ¸²æŸ“é€Ÿåº¦)

### é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸ

> onLoad å’Œ DOMContentLoaded è§¦å‘çš„å…ˆåé¡ºåºï¼Ÿ

é¡µé¢ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–ï¼Œä¼šè§¦å‘ document ä¸Šçš„ readystatechange äº‹ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ onreadyState æ‹¿åˆ°å½“å‰çš„çŠ¶æ€ã€‚

```js
// åˆå§‹æ—¶å€™çš„readyState

console.log(document.readyState);
// æ¯æ¬¡æ”¹å˜éƒ½æ‰“å°readyState

document.addEventListener("readystatechange", () =>
	console.log(document.readyState);
);
```

ä¸Šé¢çš„ä»£ç åœ¨ Chrome ä¸­çš„è¾“å‡ºæ˜¯ï¼š

1. loadingï¼šåŠ è½½ document
2. interactiveï¼šdocument åŠ è½½æˆåŠŸï¼ŒDOM æ ‘æ„å»ºå®Œæˆ
3. completeï¼šå›¾åƒï¼Œæ ·å¼è¡¨å’Œæ¡†æ¶ä¹‹ç±»çš„å­èµ„æºå®ŒæˆåŠ è½½

æ‰€ä»¥ï¼ŒDOMContentLoaded æ˜¯åœ¨ onload å‰è¿›è¡Œçš„ã€‚

- DOMContentLoaded DOM æ ‘æ„å»ºå®Œæ¯•åè§¦å‘ï¼Œè¿™ä¸ªé˜¶æ®µå¯ä»¥åˆ©ç”¨ js å»è®¿é—®å…ƒç´ 
- load é¡µé¢çš„æ‰€æœ‰èµ„æºåŠ è½½å®Œæ¯•åè§¦å‘ï¼Œé€šå¸¸æˆ‘ä»¬ä¸éœ€è¦ç­‰å¾…è¿™ä¹ˆä¹…ã€‚
- beforeunload å³å°†ç¦»å¼€é¡µé¢æ—¶è§¦å‘

### property å’Œ attribute åŒºåˆ«

DOM èŠ‚ç‚¹æœ¬è´¨æ˜¯ JS å¯¹è±¡ï¼Œå› æ­¤ property å¯ä»¥ç†è§£æˆ JS å¯¹è±¡ä¸Šçš„å±æ€§ã€‚è€Œ property æ”¹å˜ï¼Œå°±æ˜¯ç›´æ¥æ”¹å˜ JS å¯¹è±¡çš„å±æ€§ã€‚
æ¯”å¦‚<p>ä¸Šæœ‰ styleã€classNameã€nodeName å’Œ nodeType ç­‰å±æ€§ã€‚

attribute æ˜¯æŒ‡ HTML çš„å±æ€§ï¼Œæ”¹å˜ attribute å°±æ˜¯é’ˆå¯¹ HTML å±æ€§çš„ set å’Œ getï¼Œå’Œ JS å¯¹è±¡æ— å…³ã€‚
å¸¸ç”¨çš„ API å°±æ˜¯ï¼šgetAttribute å’Œ setAttributeã€‚å¸¸è§çš„ç”¨æ³•æ˜¯ setAttribute()æ¥è®¾ç½®å…ƒç´ çš„ styleã€‚

### cookieã€localStorage ä»¥åŠ sessionStorage

- cookie
  - å¤§å°é™åˆ¶ä¸º 4kbï¼Œä¸»è¦ç”¨æ¥ä¿å­˜ç™»å½•ä¿¡æ¯ï¼ŒsessionId
  - ä¸€èˆ¬ç”±æœåŠ¡å™¨è®¾ç½®å¤±æ•ˆæ—¶é—´ï¼Œå¦‚æœæ˜¯æµè§ˆå™¨ç”Ÿæˆï¼Œé»˜è®¤æµè§ˆå™¨å…³é—­å¤±æ•ˆ
  - æ¯æ¬¡éƒ½è¢«æºå¸¦åœ¨ http è¯·æ±‚å¤´ï¼Œæ‰€ä»¥æ•°æ®é‡è¿‡å¤§çš„æ—¶å€™æœ‰æ€§èƒ½å½±å“

localStorageï¼š å¤§å°é™åˆ¶ä¸º 5MBï¼Œç”¨äºæ°¸ä¹…å­˜å‚¨ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºç¼“å­˜ ajax ä¿¡æ¯ç”¨äºç¦»çº¿åº”ç”¨ã€‚å®ƒä¿å­˜åœ¨æµè§ˆå™¨ï¼Œä¸å‚ä¸ä¸æœåŠ¡å™¨çš„é€šä¿¡ã€‚
sessionStorageï¼š ä¸ localStorage ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯ä¿¡æ¯ä¸æ˜¯æ°¸ä¹…å­˜å‚¨ï¼Œä»…åœ¨å½“å‰ä¼šè¯ä¸‹æœ‰æ•ˆã€‚å…³é—­æ ‡ç­¾æˆ–è€…æµè§ˆå™¨ï¼Œéƒ½ä¼šæ¸…é™¤ã€‚

### AJAX

```js
const xhr = new XMLHttpRequest();

xhr.onreadystatechange = () => {
  if (xhr.readyState === 4) {
    // 4 ä¸ºç»“æœæ¥æ”¶å®Œæ¯•
    xhr.status === 200 && console.log(xhr.resoponseText);
  }
};
```

### Featch API

```js
// æ”¯æŒ promise
const api = "http://localhost:5050/search/song";
const formData = new FormData();
formData.append("key", "å‘¨æ°ä¼¦");
formData.append("page", 1);
formData.append("limit", 10);
formData.append("vendor", "qq");
fetch(api, {
  method: "POST",
  body: formData
})
  .then(res => res.json())
  .then(json => console.log(json));

// koa-bodypaerser ä¸æ”¯æŒ fromDataï¼Œå› æ­¤ä½¿ç”¨å¦‚ä¸‹ä»£ç 
const api = "http://localhost:5050/search/song";
fetch(api, {
  method: "POST",
  body: JSON.stringify({
    key: "å‘¨æ°ä¼¦",
    page: 1,
    limit: 10,
    vendor: "qq"
  }),
  headers: new Headers({
    "Content-Type": "application/json"
  })
})
  .then(res => res.json())
  .then(json => console.log(json));
```

### è·¨åŸŸ

- JSONP åˆ©ç”¨ script å®ç°ï¼Œåªæ”¯æŒ get
- webpack dev æ¨¡å¼,é…åˆ proxy é€‰é¡¹ï¼Œå¯åŠ¨ä¸€ä¸ªå‰ç«¯æœåŠ¡å™¨ï¼Œå®ç°ä»£ç†è½¬å‘
- CORS: åç«¯å…è®¸è·¨åŸŸèµ„æºå…±äº«

JSONP å®ç°

```js
// å®šä¹‰å›è°ƒå‡½æ•°
const handleResponse = data => {
  console.log(data);
};

// æ„é€  <script> æ ‡ç­¾
let script = document.createElement("script");
script.src =
  "https://api.douban.com/v2/book/search?q=javascript&count=1&callback=handleResponse";

// å‘documentä¸­æ·»åŠ  <script> æ ‡ç­¾ï¼Œå¹¶ä¸”å‘é€GETè¯·æ±‚
document.body.appendChild(script);
```
